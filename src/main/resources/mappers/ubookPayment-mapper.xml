<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ubookPaymentMapper">

	 	<resultMap id="ubookResultSet" type="Ubook">
		<id property="ubookNo" column="UBOOK_NO"/>
		<result property="bSellerNo" column="BSELLER_NO"/>
		<result property="ubookName" column="UBOOK_NAME"/>
		<result property="ubookWriter" column="UBOOK_WRITER"/>
		<result property="ubookIsbn" column="UBOOK_ISBN"/>
		<result property="ubCategory" column="UB_CATEGORY"/>
		<result property="ubookTrans" column="UBOOK_TRANS"/>
		<result property="ubookPub" column="UBOOK_PUB"/>
		<result property="ubookPubDate" column="UBOOK_PUBDATE"/>		
		<result property="ubookOPrice" column="UBOOK_O_PRICE"/>		
		<result property="ubookPrice" column="UBOOK_PRICE"/>		
		<result property="ubookStock" column="UBOOK_STOCK"/>
		<result property="ubookQual" column="UBOOK_QUAL"/>		
		<result property="ubookDetail" column="UBOOK_DETAIL"/>	
		<result property="ubookContent" column="UBOOK_CONTENT"/>		
		<result property="ubookImg" column="UBOOK_IMG"/>		
		<result property="ubookStatus" column="UBOOK_STATUS"/>
		<result property="sellerNickN" column="SELLER_NICKN"/>
		<result property="sellerNo" column="SELLER_NO"/>
		<result property="sellerId" column="SELLER_ID"/>
	</resultMap>
	<insert id="insertUbookPayment" parameterType="UbookPayment">
	INSERT INTO UBOOK_PAYMENT VALUES (SEQ_UBPAYMENTNO.NEXTVAL,#{userIdUb},#{shippingNameUb},#{shippingAddressUb},#{shippingPhoneUb},#{deliveryRequestUb},DEFAULT,#{totalCostUb},0,#{totalPayCostUb},#{deliveryCostUb})
	<selectKey keyProperty="paymentNoUb" resultType="_int" order="AFTER">
	SELECT SEQ_UBPAYMENTNO.CURRVAL FROM DUAL
	</selectKey>
	</insert>
	
	<insert id="insertUbookPaymentDetailUb" parameterType="UbookPaymentDetail">
	INSERT INTO UBOOK_PAYMENTDETAIL VALUES (SEQ_UBPAYMENTDETAILNO.NEXTVAL,#{paymentNoUb},#{ubookNoUb},#{ubookImgUb},#{ubookNameUb},#{quantityUb},#{ubookOPriceUb},#{ubookPriceUb},#{deliveryDateUb},DEFAULT)
	</insert>
	
	<delete id="deleteCart">
	DELETE FROM UBOOK_CART WHERE CARTNO = #{cartNo}
	</delete>
	
	<!-- 도서 삭제될 때 수량도 변경 #{ubookNoUb}-->
	<update id="updateUbookStock" parameterType="Ubook">
		UPDATE UBOOK
		SET
		UBOOK_STOCK = (UBOOK_STOCK-1)
		WHERE UBOOK_NO=#{cartUbNo}
	</update>
	
	<!-- 나의 주문목록 조회  -->
	<select id="selectMyOrderList" resultType ="UbookPayment">
		 SELECT * FROM UBOOK_PAYMENT
		 WHERE USERIDUB =#{userIdUb}
	</select>
	
	<!-- payment list 페이징  -->
	<select id="selectListCount"  resultType="_int">
		SELECT COUNT(*) FROM UBOOK_PAYMENT
		WHERE USERIDUB =#{userIdUb}
		
	</select>
	
	<!-- 나의 주문 목록 상세 조회  -->
	<select id="selectMyOrderListDetail" resultType="UbookPaymentDetail" parameterType="_int">
		SELECT * FROM UBOOK_PAYMENTDETAIL
		WHERE PAYMENTNOUB=#{paymentNoUb}
		ORDER BY DELIVERYDATEUB DESC 
	</select>
		<!-- 구매확정 상태로 변경하기 -->
	<select id="confirmOrder" resultType="UbookPaymentDetail" parameterType="_int">
		UPDATE UBOOK_PAYMENTDETAIL
		SET DELIVERYSTATUSUB = 8
		WHERE PAYMENTDETAILNOUB = ${paymentDetailNoUb}
	</select>
	
	<select id="selectDeliveryList" parameterType="UbookPaymentDetail">
		
		SELECT * FROM UBOOK_PAYMENTDETAIL
		WHERE PAYMENTNOUB = #{paymentNoUb}
	
	</select>
	
	<select id="selectDeliveryPaymentNoList" resultType="UbookPayment">
	
	SELECT * FROM UBOOK_PAYMENT
	WHERE PAYMENTNOUB IN
	<foreach item="item" collection="list" open="(" close=")" separator=",">
		#{item}
	</foreach>
	
	</select>

	
</mapper>
